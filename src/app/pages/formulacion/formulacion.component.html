<mat-card class="card-oas">
  <mat-card-header>
    <mat-card-title>Selección de Plan</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <mat-form-field appearance="fill" [style.width.%]="100">
      <mat-label id="tipo-input-label">Seleccionar Plan</mat-label>
        <mat-select (selectionChange)="onChangeP($event.value)">
          <mat-option>--</mat-option>
          <mat-option *ngFor="let plan of planes" [value]="plan">
            {{plan.nombre}}
          </mat-option>
        </mat-select>
    </mat-form-field>
  </mat-card-content>
  <ng-container *ngIf="planSelected">
    <mat-form-field appearance="fill" [style.width.%]="100">
      <mat-label id="tipo-input-label">Seleccionar Unidad</mat-label>
        <mat-select (selectionChange)="onChangeU($event.value)">
          <mat-option>--</mat-option>
          <mat-option *ngFor="let unidad of unidades" [value]="unidad">
            {{unidad.nombre}}
          </mat-option>
        </mat-select>
    </mat-form-field>
  </ng-container>
  <ng-container *ngIf="unidadSelected">
    <mat-form-field appearance="fill" [style.width.%]="100">
      <mat-label id="tipo-input-label">Seleccionar Vigencia</mat-label>
        <mat-select (selectionChange)="onChangeV($event.value)">
          <mat-option>--</mat-option>
          <mat-option *ngFor="let vigencia of vigencias" [value]="vigencias">
            {{vigencia.nombre}}
          </mat-option>
        </mat-select>
    </mat-form-field>
  </ng-container>
</mat-card>

<mat-card class="card-oas" *ngIf="vigenciaSelected">
  <mat-card-header>
    <mat-card-title>Formulación {{plan.nombre}}</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="form">
      <mat-horizontal-stepper>
        <mat-step *ngFor="let step of steps; let index = index; let last = last;">
          <ng-template matStepLabel>{{step.nombre}}</ng-template>
          <mat-accordion cdkDropList>
            <mat-expansion-panel *ngFor="let subs of step.sub" cdkDrag
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  {{subs.nombre}}
                </mat-panel-title>
                <mat-panel-description>
                  
                </mat-panel-description>
              </mat-expansion-panel-header>
              <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subs.type == 'input'">
                <mat-label>Digite la información:</mat-label>
                <textarea matInput formControlName="{{subs.id}}" placeholder="Escriba la información deseada" required="{{subs.required}}"></textarea>
                <mat-icon matSuffix>create</mat-icon>
              </mat-form-field>
              <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subs.type == 'number'">
                <mat-label>Ingrese el valor:</mat-label>
                <input type="number" matInput formControlName="{{subs.id}}" placeholder="Ingrese el valor numérico" required="{{subs.required}}">
                <mat-icon matSuffix>create</mat-icon>
              </mat-form-field>
              <mat-form-field appearance="fill" [style.width.%]="100" *ngIf="subs.type == 'select'">
                  <mat-select (selectionChange)="onChange($event.value)" [(value)]="selected" formControlName="{{subs.id}}" required="{{subs.required}}">
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let opt of subs.options" [value]="opt">
                      {{opt.nombre}}
                    </mat-option>
                  </mat-select>
              </mat-form-field>
              <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="subs.type == 'button'" (click)="but()">Foo</button>
            </mat-expansion-panel>
          </mat-accordion>
          <br><br>
          <div>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="index !== 0" matStepperPrevious (click)="prevStep(index)">Volver</button>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="!last" matStepperNext (click)="nextStep(index)">Siguiente</button>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="last" [disabled]="!form.valid" (click)="submit()">Guardar</button>
            <!-- <button *ngIf="index !== 0" matStepperPrevious class="btn btn-primary" type="button" (click)="prevStep(index)">Atrás</button>
            <button *ngIf="!last" matStepperNext class="btn btn-primary" type="button" [disabled]="!formStep.at(index).valid" (click)="nextStep(index)">Siguiente</button>
            <button *ngIf="last" class="btn btn-primary" [disabled]="!formStep.valid" type="submit">Guardar</button> -->
          </div> 
        </mat-step>
      </mat-horizontal-stepper>
    </form>
  </mat-card-content>
</mat-card>

    
  