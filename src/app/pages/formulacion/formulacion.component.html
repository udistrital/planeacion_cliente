<!-- SELECCIÓN MENÚ PRINCIPAL -->
<mat-card class="card-oas">
  <mat-card-header>
    <mat-card-title>Formulación de Planes</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <ng-container>
      <mat-form-field appearance="fill" [style.width.%]="100">
        <mat-label id="tipo-input-label">Seleccione la Unidad</mat-label>
          <mat-select (selectionChange)="onChangeU($event.value)">
            <mat-option>--</mat-option>
            <mat-option *ngFor="let unidad of unidades" [value]="unidad">
              {{unidad.Nombre}}
            </mat-option>
          </mat-select>
      </mat-form-field>
    </ng-container>
    <ng-container *ngIf="unidadSelected">
      <mat-form-field appearance="fill" [style.width.%]="100">
        <mat-label id="tipo-input-label">Seleccione la Vigencia</mat-label>
          <mat-select (selectionChange)="onChangeV($event.value)">
            <mat-option>--</mat-option>
            <mat-option *ngFor="let vigencia of vigencias" [value]="vigencia">
              {{vigencia.Nombre}}
            </mat-option>
          </mat-select>
      </mat-form-field>
    </ng-container>
    <ng-container *ngIf="vigenciaSelected">
      <mat-form-field appearance="fill" [style.width.%]="100">
        <mat-label id="tipo-input-label">Seleccione el Plan</mat-label>
          <mat-select (selectionChange)="onChangeP($event.value)">
            <mat-option>--</mat-option>
            <mat-option *ngFor="let plan of planes" [value]="plan">
              {{plan.nombre}}
            </mat-option>
          </mat-select>
      </mat-form-field>
    </ng-container>
  </mat-card-content>
  <mat-card-footer *ngIf="clonar" style="text-align: center;">
    <ng-container>
      <button mat-raised-button color="primary" (click)="formularPlan()">
        Formular plan
      </button>
    </ng-container>
    <br><br>
  </mat-card-footer>
</mat-card>

<br><br>

<!-- FORMULACIÓN -->
<mat-card class="card-oas" *ngIf="!clonar && planAsignado">
  <mat-card-header>
    <mat-card-title *ngIf="plan != undefined">Formulación {{plan.nombre}}</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <!-- TABLA ESTÁTICA
    <mat-form-field appearance="standard" [style.width.%]="50">
      <mat-label>Búsqueda</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Ej. Actividad" #input>
    </mat-form-field>
    <div class="mat-elevation-z8">
      <table mat-table [dataSource]="dataSource" matSort>
          <ng-container matColumnDef="numero">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Número actividad </th>
              <td mat-cell *matCellDef="let row"> {{row.numero}} </td>
          </ng-container>
      <ng-container matColumnDef="nombre">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre actividad </th>
          <td mat-cell *matCellDef="let row"> {{row.nombre}} </td>
      </ng-container>
      <ng-container matColumnDef="rubro">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Rubro presupuestal </th>
          <td mat-cell *matCellDef="let row"> {{row.rubro}} </td>
      </ng-container>
      <ng-container matColumnDef="valor">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Valor presupuestal </th>
        <td mat-cell *matCellDef="let row"> {{row.valor}} </td>
      </ng-container>
      <ng-container matColumnDef="observacion">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Observación </th>
        <td mat-cell *matCellDef="let row"> {{row.observacion}} </td>
      </ng-container>
      <ng-container matColumnDef="activo">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Estado </th>
        <td mat-cell *matCellDef="let row"> {{row.activo}} </td>
      </ng-container>
      <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="header-align-right"> Acciones </th>
          <td mat-cell *matCellDef="let row" class="td-align-right">
              <button mat-icon-button (click)="editar(row)"><mat-icon>edit</mat-icon></button>
         </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">No se han encontrado resultados para la búsqueda "{{input.value}}"</td>
      </tr>
      </table>
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of users"></mat-paginator>
    </div>
    <br><br> -->
    <mat-card class="card-oas-int" *ngIf="addActividad">
    <!-- FORMULARIO -->
    <mat-card-content>
    <form [formGroup]="form">
      <mat-horizontal-stepper>
        <mat-step *ngFor="let step of steps; let index = index; let last = last;">
          <ng-template matStepLabel>{{step.nombre}}</ng-template>
          <mat-accordion cdkDropList>
            <mat-expansion-panel *ngFor="let subs of step.sub" cdkDrag
            (opened)="panelOpenState = true"
            (closed)="panelOpenState = false">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  {{subs.nombre}}
                </mat-panel-title>
                <mat-panel-description>
                  
                </mat-panel-description>
              </mat-expansion-panel-header>
              <ng-container *ngIf="subs.sub">
                <mat-accordion>
                  <mat-expansion-panel *ngFor="let subpanel of subs.sub"
                    (opened)="panelOpenState = true"
                    (closed)="panelOpenState = false">
                    <mat-expansion-panel-header>
                      <mat-panel-title>{{subpanel.nombre}}</mat-panel-title>
                      <mat-panel-description>

                      </mat-panel-description>
                    </mat-expansion-panel-header>
                    
                    <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subpanel.type == 'input'">
                      <mat-label>Digite la información:</mat-label>
                      <textarea matInput formControlName="{{subpanel.id}}" placeholder="Escriba la información deseada" required="{{subpanel.required}}"></textarea>
                      <mat-icon matSuffix>create</mat-icon>
                    </mat-form-field>
                    <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subpanel.type == 'numeric'">
                      <mat-label>Ingrese el valor:</mat-label>
                      <input type="number" matInput formControlName="{{subpanel.id}}" placeholder="Ingrese el valor numérico" required="{{subpanel.required}}">
                      <mat-icon matSuffix>create</mat-icon>
                    </mat-form-field>
                    <mat-form-field appearance="fill" [style.width.%]="100" *ngIf="subpanel.type == 'select'">
                        <mat-select (selectionChange)="onChange($event.value)" [(value)]="selected" formControlName="{{subpanel.id}}" required="{{subpanel.required}}">
                          <mat-option>--</mat-option>
                          <mat-option *ngFor="let opt of subs.options" [value]="opt">
                            {{opt.nombre}}
                          </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="subpanel.type == 'button'" (click)="but()">Foo</button>

                    <!-- OBSERVACIÓN -->

                    <ng-container *ngIf="estado != '614d3ad301c7a200482fabfd'">
                      <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subpanel.required == 'true'">
                        <mat-label>Campo de observación:</mat-label>
                        <textarea matInput formControlName="{{subpanel.id+'_o'}}" placeholder="Escriba la observación" required="false"></textarea>
                        <mat-icon matSuffix>create</mat-icon>
                      </mat-form-field>
                    </ng-container>

                  </mat-expansion-panel>
                </mat-accordion>
              </ng-container>
              <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subs.type == 'input'">
                <mat-label>Digite la información:</mat-label>
                <textarea matInput formControlName="{{subs.id}}" placeholder="Escriba la información deseada" required="{{subs.required}}"></textarea>
                <mat-icon matSuffix>create</mat-icon>
              </mat-form-field>
              <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subs.type == 'numeric'">
                <mat-label>Ingrese el valor:</mat-label>
                <input type="number" matInput formControlName="{{subs.id}}" placeholder="Ingrese el valor numérico" required="{{subs.required}}">
                <mat-icon matSuffix>create</mat-icon>
              </mat-form-field>
              <mat-form-field appearance="fill" [style.width.%]="100" *ngIf="subs.type == 'select'">
                  <mat-select (selectionChange)="onChange($event.value)" [(value)]="selected" formControlName="{{subs.id}}" required="{{subs.required}}">
                    <mat-option>--</mat-option>
                    <mat-option *ngFor="let opt of subs.options" [value]="opt">
                      {{opt.nombre}}
                    </mat-option>
                  </mat-select>
              </mat-form-field>
              <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="subs.type == 'button'" (click)="but()">Foo</button>

              <!-- OBSERVACIÓN -->
              <ng-container *ngIf="estado != '614d3ad301c7a200482fabfd'">
                <mat-form-field appearance="outline" [style.width.%]="100" *ngIf="subs.required == 'true'">
                  <mat-label>Campo de observación:</mat-label>
                  <textarea matInput formControlName="{{subs.id+'_o'}}" placeholder="Escriba la observación" required="false"></textarea>
                  <mat-icon matSuffix>create</mat-icon>
                </mat-form-field>
              </ng-container>

            </mat-expansion-panel>
          </mat-accordion>
          <br><br>
          <div>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="index !== 0" matStepperPrevious (click)="prevStep(index)">Volver</button>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="!last" matStepperNext (click)="nextStep(index)">Siguiente</button>
            <br><br>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" (click)="ocultar()">Cancelar</button>
            <button mat-raised-button color="primary" type="submit" class="col-3 mt-2 mb-3" *ngIf="last" [disabled]="!form.valid" (click)="submit()">Guardar</button>
            <!-- <button *ngIf="index !== 0" matStepperPrevious class="btn btn-primary" type="button" (click)="prevStep(index)">Atrás</button>
            <button *ngIf="!last" matStepperNext class="btn btn-primary" type="button" [disabled]="!formStep.at(index).valid" (click)="nextStep(index)">Siguiente</button>
            <button *ngIf="last" class="btn btn-primary" [disabled]="!formStep.valid" type="submit">Guardar</button> -->
          </div> 
        </mat-step>
      </mat-horizontal-stepper>
    </form>
  </mat-card-content>
  </mat-card>
  </mat-card-content>
  <!-- AGREGAR ACTIVIDAD / CULMINAR PLAN -->
  <mat-card-footer style="text-align: center;">
    <ng-container>
      <button mat-raised-button color="primary" (click)="agregarActividad()" [disabled]="addActividad">
        Agregar actividad
      </button>
      <br><br>
      <button mat-raised-button color="primary" (click)="culminarPlan()">
        Culminar plan
      </button>
    </ng-container>
    <br><br>
  </mat-card-footer>
</mat-card>
  